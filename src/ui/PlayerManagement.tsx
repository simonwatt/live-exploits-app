import { useState } from 'react';  // Import useState for local state
import { Title, Paper, List, Button, Loader } from '@mantine/core';  // Import components from Mantine
import PlayerForm from './PlayerForm';  // Import PlayerForm component
import { usePlayerContext } from '../contexts/PlayerContext';

export function PlayerManagement() {
  const { state } = usePlayerContext();
  const { players, tags, tagsLoaded } = state;
  const [selectedPlayer, setSelectedPlayer] = useState(null);

  const handlePlayerClick = (playerId) => {
    const player = players.find((p) => p.id === playerId) || null;
    setSelectedPlayer(player); // Set the selected player for editing
  };

  const handleNewPlayer = () => {
    setSelectedPlayer(null); // Clear the selected player
  };

  return (
    <>
      <Title order={2} style={{ marginTop: -20 }}>
        Players
      </Title>
      <Paper shadow="xs" p="md" mb="md">
        <Button variant="outline" onClick={handleNewPlayer} style={{ marginBottom: 10 }}>
          New Player
        </Button>
        <List>
          {players.map((player) => (
            <List.Item key={player.id}>
              <Button
                variant="subtle"
                onClick={() => handlePlayerClick(player.id)}
              >
                {player.name}
              </Button>
            </List.Item>
          ))}
        </List>
      </Paper>

      {tagsLoaded ? (
        <PlayerForm player={selectedPlayer} />
      ) : (
        <Loader /> // Show loader while tags are being loaded
      )}
    </>
  );
}

export default PlayerManagement;
